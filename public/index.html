<!DOCTYPE html>
<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="jquery.dateFormat-1.0.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      $(document).ready(function () {
        var lastBy;
        var odd = false;
        var socket = io.connect(location.href);
        socket.on('connect', function () {
          // nothing
        });
        socket.on('message', function (message) {
          var html;
          if(message.who != lastBy) {
            odd ^= true;
            var imgUrl = 'http://static1.robohash.com/' + encodeURIComponent(message.who);
            var avatar = '<a href="' + imgUrl + '"><img class="avatar" src="' + imgUrl + '"/></a>';
            var time = '<span class="timestamp">' + timestamp() + '</span>';
            var who = '<span class="who">' + message.who + '</span>';
            html = '<br clear="left"/><div class="details ' + (odd ? 'odd' : 'even') + '">' + avatar + time + '<br/>' + who + '</div><div class="content push-down ' + (odd ? 'odd' : 'even') + '">';
          } else {
            html = '<div class="content ' + (odd ? 'odd' : 'even') + '">';
          }
          $('#messages').append(
            html + message.msg + '</div>'
          ).scrollTop(
            $("#messages").attr("scrollHeight") + 100
          );
          lastBy = message.who;
        });

        $('input').keydown(function (event) {
          if(event.keyCode === 13) {
            socket.emit('message', {msg: $('input').val()});
            $('input').val('');
          }
        })[0].focus();
      });

      function timestamp() {
        var t = new Date();
        return $.format.date(t, 'ddd hh:mm a');
      };
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      html, body {
        height: 100%;
      }
      #messages {
        margin-bottom: 25px;
      }
      #input {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 99%;
      }
      .timestamp {
        color: gray;
      }
      .who {
        color: green;
      }
      .avatar {
        height: 50px;
        float: left;
      }
      .details {
        clear: left;
        width: 210px;
        height: 50px;
        padding: 5px;
        float: left;
      }
      .content {
        margin-left: 220px;
        padding: 5px;
      }
      .push-down {
      }
      .odd {
        background-color: #eee;
      }
    </style>
  </head>
  <body>
    <input type="text" id="input"/>
    <div id="messages" />
  </body>
</html>
